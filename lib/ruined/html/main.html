<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html> <head>
 <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
 <meta http-equiv="content-style-type" content="text/css"/>
 <title></title>
 <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.8.5.custom.css"></link>
 <link rel="stylesheet" href="../css/ruin.css"></link>
 <script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
 <script type="text/javascript" src="../js/jquery-ui-1.8.5.custom.min.js"></script>
 <script type="text/javascript">
var files = new Object();
var priorLine = { line: null, index: null };
var interval = 1000;
var contTimer = null;
function addFile(name, line, command) {
  var a = name.split('/');
  $('#lists').tabs( "add" , '/debug/file/' + name , a[a.length - 1]);
  var index = $('#lists').tabs('length') - 1;
  $('#lists').tabs('select', index);
  $('td').bind('click', function(ev) {
    var sub = 'false';
    if (ev.currentTarget.style.backgroundColor == '') {
      sub = 'true';
    }
    var index = $('#lists').tabs('option', 'selected');
    var key, file;
    for (key in files) {
      if (files[key] == index) {
        file = key;
        break;
      }
    }
    if (file != null) {
      var line = 0;
      var list = $('#ui-tabs-' + (index * 2 + 2) + ' > table > tbody > tr > td');
      for (var i = 0; i < list.length; i++) {
        if (list[i] == ev.currentTarget) {
          line = i + 1;
          break;
        }
      }
      $.get('/debug/break/' + sub + '/' + file + '/' + line, function() {
        var bgclr = '';
        var clr = '';
        if (sub == 'true') {
          bgclr = 'saddlebrown';
          clr = 'white';
        }
        ev.currentTarget.style.backgroundColor = bgclr;
        ev.currentTarget.style.color = clr;
      });
    }
  });
  return index;
}
function changeTab(index) {
  $('#lists').tabs('select', index);
}
function lineColor(command, brk) {
  if (command == 'cont' && !brk) {
    return 'aquamarine';
  }
  return 'yellow';
}
function stopRun() {
  clearTimeout(contTimer);
  contTimer = null;
  $('#run').button('option', 'label', 'run');
}
function setLine(index, line, command, brk) {
  if (line > 0) {
    --line;
  }
  if (priorLine.index != null) {
    var style = $('#ui-tabs-' + (priorLine.index * 2 + 2) + ' > table > tbody > tr > td')[priorLine.line].style;
    style.backgroundColor = priorLine.backgroundColor;
    style.color = priorLine.color;
  }
  var style = $('#ui-tabs-' + (index * 2 + 2) + ' > table > tbody > tr > td')[line].style;
  priorLine.index = index;
  priorLine.line = line;
  priorLine.color = style.color;
  priorLine.backgroundColor = style.backgroundColor;
  style.backgroundColor = lineColor(command, brk);
  style.color = '';
}
function stepProc(command) {
  $.getJSON('/debug/' + command, function(data) {
    if (files[data.file] == null) {
      files[data.file] = addFile(data.file, data.line, command);
      setLine(files[data.file], data.line, command, data['break']);
    } else {
      changeTab(files[data.file]);
      setLine(files[data.file], data.line, command, data['break']);
    }
    if (data['break']) {
      stopRun();
    }
  });
}
function contProc(command) {
  stepProc(command);
  contTimer = setTimeout('contProc("' + command + '");', interval);
}

$(document).ready(function() {
  $('#lists').tabs();
  $('#lists').tabs({ajaxOptions: {async: false}});
  $('#lists').tabs('option', 'cache', true);
  $('#vars').tabs();
  $('#vars').tabs('option', 'cache', true);
  $('#intval').slider();
  $('#intval').slider('option', 'value', 10);
  $('#intval').slider({
    change: function(e, ui) {
      interval = $('#intval').slider('option', 'value') * 100;
    }
  });
  $.ajaxSetup({cache: false});

  $('button').button();
  $('#run').click(function() {
    if (contTimer == null) {
      contProc('cont');
      $('#run').button('option', 'label', 'stop');
    } else {
      stopRun();
    }
  });
  $('#step').click(function() {
    stepProc('step');
  });
  $('#waiting').ajaxError(function() {
    if (contTimer != null) {
      stopRun();
    }
    alert('error');
  });
  stepProc('stepping');
});
</script>
</head>

<body>
<div style="float: left; width: 60%;">
  <div style="float: left; width: 40%">
    <div class="console">
      <button id="step">Step</button>
      <button id="run">Run</button>
    </div>
  </div>
  <div style="float: left; width: 50%;">
    <div id="intval"></div>
    <div style="float: left; width: 50%">fast &lt;----</div>
    <div style="float: right">----&gt; slow</div>
  </div>
  <div id="lists" style="clear: both; overflow: scroll;">
    <ul></ul>
  </div>
</div>
<div>
  <div id="vars" style="overflow: scroll;">
    <ul>
      <li><a href="#local-vars">Local Vars</a></li>
      <li><a href="#self-vars">Self Vars</a></li>
      <li><a href="#global-vars">Global Vars</a></li>
    </ul>
    <div id="local-vars">
    </div>
    <div id="self-vars">
    </div>
    <div id="global-vars">
    </div>
  </div>
</div>
<div style="clear: both;">
  <hr>
  <div id="waiting"></div>
  <address></address>
  <!-- hhmts start --> Last modified: Sun Oct 10 21:36:52 +0900 2010 <!-- hhmts end -->
</div>    
</body> </html>
